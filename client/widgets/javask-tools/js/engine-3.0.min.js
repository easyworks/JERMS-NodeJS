/**
 * Javask javascript tools
 * 本工具类需要 jQuery 1.11.0 和 jQuery.ua 插件支持
 * 
 * @fileoverview engine.js
 * @author Javask
 * @version 3.0.2
 * 
 * @update
 * 	2014-11-12( v3.0.1 ):
 * 		1. 增加启用复制( $().disableSelection() )和禁用复制( $().enableSelection() )扩展
 *  2015-02-12( v3.0.2 ):
 * 		1. 优化日期格式验证( javask.string.isDate() )和电子邮件格式验证( javask.string.isEmail() )函数的验证逻辑
 * 		2. 增加IP格式验证( javask.string.isIP() )和手机号码格式验证( javask.string.isMobile() )函数
 */

var _javask={};if("undefined"!=$.type(javask))_javask=javask,javask={};else var javask={};$.extend(javask,{version:"3.0",browser:{},config:{},ui:{},plug:{},imports:{},object:{},global:{},string:{},math:{},tag:{},url:{},ScriptFragment:"<script[^>]*>([\\S\\s]*?)\x3c/script>",JSONFilter:/^\/\*-secure-([\s\S]*)\*\/\s*$/,N:$.noop,K:function(a){return a},T:function(){return!0},F:function(){return!1}});$.fn.extend({hasAttr:function(a){return!javask.object.isUndefined(this.attr(a))},isHidden:function(){var a=!1;this.each(function(b,c){c=$(c);a="none"==c.css("display")});return a},exist:function(){return 0<this.length},disableSelect:function(){javask.browser.ua.isIe?this.bind("selectstart dragstart copy",javask.F):this.css({"-moz-user-focus":"ignore","-moz-user-input":"disabled","-moz-user-select":"none","-webkit-user-select":"none"});this.bind("keydown",javask.browser.screenCtrl);return this},enableSelect:function(){javask.browser.ua.isIe?this.unbind("selectstart dragstart copy",javask.F):this.css({"-moz-user-focus":"normal","-moz-user-input":"auto","-moz-user-select":"auto","-webkit-user-select":"auto"});this.unbind("keydown",javask.browser.screenCtrl);return this},disableSelection:function(){var a="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(a+".javask-disableSelection",function(a){a.preventDefault()})}}(),enableSelection:function(){return this.unbind(".javask-disableSelection")}});$.extend(javask.object,{isElement:function(a){return a&&1==a.nodeType},isNull:function(a){return"object"==typeof a&&!a},isString:function(a){return"string"==typeof a},isNumber:function(a){return"number"==typeof a},isUndefined:function(a){return"undefined"==typeof a}});$.extend(javask.browser,{ua:$.ua(),screenCtrl:function(a){a=a.which;if(16==a||17==a||18==a)return javask.F()},setDefault:function(a){a=a||javask.url.get();if(document.all)document.body.style.behavior="url(#default#homepage)",document.body.setHomePage(a);else if(window.sidebar){if(window.netscape)try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect")}catch(b){alert("\u8be5\u64cd\u4f5c\u88ab\u6d4f\u89c8\u5668\u62d2\u7edd\uff0c\u5982\u679c\u60f3\u542f\u7528\u8be5\u529f\u80fd\uff0c\u8bf7\u5728\u5730\u5740\u680f\u5185\u8f93\u5165 about:config,\u7136\u540e\u5c06\u9879 signed.applets.codebase_principal_support \u503c\u8be5\u4e3atrue")}Components.classes["@mozilla.org/preferences-service;1"].getService(Components.interfaces.nsIPrefBranch).setCharPref("browser.startup.homepage",a)}return!1},addBookMark:function(a,b){a=a||document.title;b=b||javask.url.get();try{window.external.addFavorite(b,a)}catch(c){try{window.sidebar.addPanel(a,b,"")}catch(d){}}return!1},clearError:function(){$(window).error(javask.T)},cssSupports:function(){var a=document.createElement("div"),b=["Khtml","O","Moz","Webkit"],c=b.length;return function(d){if(d in a.style||"-ms-"+d in a.style)return!0;for(d=d.replace(/^[a-z]/,function(a){return a.toUpperCase()});c--;)if(b[c]+d in a.style)return!0;return!1}}()});$.extend(javask.browser,{css:{transition:javask.browser.cssSupports("transition")},styleCompliant:{splitTabAndLinkBreak:function(a){var b="";a=a instanceof jQuery?a:$(a);a.each(function(a,d){d=$(d);b=d.html();b=javask.string.replaceAll(b,"\t","");b=javask.string.replaceAll(b,"\n","");b=javask.string.replaceAll(b,"\r","");b=javask.browser.ua.isIe?javask.string.replaceAll(b,"> <","><"):b;d.html(b)})}}});$.extend(javask.string,{clearTags:function(a){return(a||"").replace(/<\/?[^>]+>/gi,"")},clearScripts:function(a){return(a||"").replace(RegExp(javask.ScriptFragment,"img"),"")},htmlReplace:function(a){return(a||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace("'","&#39;").replace(/\"/g,"&#34;").replace(/ /g,"&nbsp;").replace(/\n/g,"<br />").replace(/\r/g,"<br />").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;")},htmlUnReplace:function(){return srcString.replace("<br />","\n").replace(/&nbsp;&nbsp;&nbsp;&nbsp;/g,"\t").replace(/&nbsp;/g," ").replace(/&#34/g,'"').replace(/&#39;"/,"'").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&")},scriptReplace:function(a){return a=(a||"").replace(/&#(\d+);?/g,function(a,c){return String.fromCharCode(c)}).replace(/&#x(\d+);?/ig,function(a,c){return String.fromCharCode(parseInt(c,16))}).replace(/(\Won)(\w+\s*=)/ig,"$1_$2").replace(/(\Wexpres)(sion\()/ig,"$1_$2").replace(/(\Wbehav)(ior\s*:)/ig,"$1_$2").replace(/(obj)(ect)/ig,"$1_$2").replace(/(scr)(ipt)/ig,"$1_$2").replace(/(emb)(ed)/ig,"$1_$2").replace(/\?|\{|\}|\`|\@|\$|\%|\^|\*|\+|\ |--/g,"")},vaildURL:function(a){a=a||"";return/javascript/ig.test(a)||/^http/ig.test(a)&&!/^http:\/\/([\w\.]+)\.(jframe.com|jframe.cn|jframe.net|jframe.org|jframe.com.cn)/ig.test(a)?!1:!0},scriptSearch:function(a){return(a||"").match(RegExp("Location|onload|meta|iframe|cookie|craker|innerHTML|object|script|insert|update|delete|select","gi"))},toArray:function(a){return(a||"").split("")},include:function(a,b){return-1<(a||"").indexOf(b)},startWith:function(a,b){return 0===(a||"").indexOf(b)},endWith:function(a,b){a=a||"";var c=a.length-b.length;return 0<=c&&a.lastIndexOf(b)===c},empty:function(a){return""==a},blank:function(a){return/^\s*$/.test(a||"")},trims:$.trim,trim:function(a,b){var c="";switch(b||"all"){case "all":c=javask.string.trims(a);break;case "left":c=a.replace(/(^[\s]*)/g,"");break;case "right":c=a.replace(/([\s]*$)/g,"")}return c},escape:function(a){return escape(a)},unescape:function(a){return unescape(a)},s2n:function(a,b){return parseInt(a.replace(RegExp((b||"px")+"$","i"),""),10)},replaceAll:function(a,b,c){return(a||"").split(b).join(c)},asclen:function(a){return(a||"").replace(/[\u0100-\uffff]/g,"  ").length},cut:function(a,b){a=a||"";for(var c=0,d="",e=0;e<a.length&&!(128<a.charCodeAt(e)?c+=2:c++,d+=a.charAt(e),c>=b);e++);return d},isNumber:function(a,b){if(isNaN(a))return!1;switch(b){case null:case "":case "+":return/(^\+?|^\d?)\d*\.?\d+$/.test(a);case "-":return/^-\d*\.?\d+$/.test(a);case "i":return/(^-?|^\+?|\d)\d+$/.test(a);case "+i":return/(^\d+$)|(^\+?\d+$)/.test(a);case "-i":return/^[-]\d+$/.test(a);case "f":return/(^-?|^\+?|^\d?)\d*\.\d+$/.test(a);case "+f":return/(^\+?|^\d?)\d*\.\d+$/.test(a);case "-f":return/^[-]\d*\.\d$/.test(a);default:return!0}},isDate:function(a){return/^((\d{2}(([02468][048])|([13579][26]))[\-\/\s]?((((0?[13578])|(1[02]))[\-\/\s]?((0?[1-9])|([1-2][0-9])|(3[01])))|(((0?[469])|(11))[\-\/\s]?((0?[1-9])|([1-2][0-9])|(30)))|(0?2[\-\/\s]?((0?[1-9])|([1-2][0-9])))))|(\d{2}(([02468][1235679])|([13579][01345789]))[\-\/\s]?((((0?[13578])|(1[02]))[\-\/\s]?((0?[1-9])|([1-2][0-9])|(3[01])))|(((0?[469])|(11))[\-\/\s]?((0?[1-9])|([1-2][0-9])|(30)))|(0?2[\-\/\s]?((0?[1-9])|(1[0-9])|(2[0-8]))))))(\s(((0?[0-9])|([1-2][0-3]))\:([0-5]?[0-9])((\s)|(\:([0-5]?[0-9])))))?$/.test(a)},isNum:function(a){a=a||"";var b;for(b=0;b<a.length;b++)if(-1=="1234567890.".indexOf(a.charAt(b)))return!1;return!0},textInputKeyPress:function(a,b,c,d){var e=0<a.keyCode?a.keyCode:a.which,f,g=arguments.length;if(13==e||(8==e||9==e)||b&&(65<=e&&90>=e||97<=e&&122>=e)||c&&48<=e&&57>=e)return!0;if(3<g)for(f=3;f<g;f++)if(1==arguments[f].length&&arguments[f].charCodeAt()==e)return!0;return!1},textEng:function(a){return null==(a||"").match(/^[a-zA-Z]+$/)?!1:!0},textEngNum:function(a){return null==(a||"").match(/^[a-zA-Z0-9]+$/)?!1:!0},checkInt:function(a){return!/^[0-9]*[0-9][0-9]*$/.test(a||"")?!1:!0},checkFloat:function(a){return!/^[0-9]*[0-9][0-9]*\.?\d*$/.test(a||"")?!1:!0},isEmail:function(a){return/^([a-zA-Z0-9]*[-_]?[a-zA-Z0-9]+)*@([a-zA-Z0-9]*[-_]?[a-zA-Z0-9]+)+[\.][A-Za-z]{2,3}([\.][A-Za-z]{2})?$/.test(a||"")},isIP:function(a){return/\b((?!\d\d\d)\d+|1\d\d|2[0-4]\d|25[0-5])\.((?!\d\d\d)\d+|1\d\d|2[0-4]\d|25[0-5])\.((?!\d\d\d)\d+|1\d\d|2[0-4]\d|25[0-5])\.((?!\d\d\d)\d+|1\d\d|2[0-4]\d|25[0-5])\b/.test(a)},isMobile:function(a){return/^((13[0-9])|(14[7])|(15[^4,\D])|(18[0,5-9]))\d{8}$/.test(a)},lengthByByte:function(a){a=a||"";for(var b=0,c=a.length,d=0;d<c;d++)255<a.charCodeAt(d)?b+=2:b++;return b}});$.extend(javask.math,{rand:function(a){a=Math.random(a)||Math.random();var b=0.1*(Math.round(11*Math.random())/a);0==b&&(b=javask.math.rand(a));return b},randomInt:function(a){return parseInt(Math.random()*a)}});$.extend(javask.url,{get:function(){return location.href},getParameter:function(a,b){b=b||javask.url.get();return javask.object.isNull(b.match(RegExp("[?#&]"+a+"=(.*?)(?:[#&]|$)","i")))?"":RegExp.$1},getSuffix:function(a){a=a||javask.url.get();var b=a.lastIndexOf(".");return-1==b?"":a.substr(b+1)},getProtocol:function(a){a=a||javask.url.get();return javask.object.isNull(a.match(/^(\w+):\/\//))?"":RegExp.$1},getHost:function(a){a=a||javask.url.get();return javask.object.isNull(a.match(/:\/\/([a-zA-Z0-9.]+)/))?"":RegExp.$1},isValid:function(){return!0},isLocal:function(a){a=a||javask.url.get();return!javask.object.isNull(a.match(/(^file|^[A-Za-z]):/i))}});$.extend({p:javask.url.getParameter,blockPing:function(){top!=self&&(top.location=location)},c:function(){window.opener=null;window.close()},$open:function(a,b,c,d){c="height="+d+",width="+c+""+(",left="+(screen.availWidth-c)/2);c+=",top="+(screen.availHeight-d)/2;c+=",toolbar=no,scrollbars=yes,menubar=no,resizable=no,directories=no";return window.open(a,b,c)},go:function(a){location.href=a}});$.extend(javask.imports,{loadCSS:function(a,b){var c=$("head"),d;$("link").each(function(b,c){c=$(c);if(!javask.string.blank(c.attr("href"))&&javask.string.include(c.attr("href"),a))return d=c,!1});javask.object.isUndefined(d)&&(d=javask.tag.css().attr({id:b,href:a}).appendTo(c));return d},loadJS:function(a,b){var c=$("head"),d;$("script").each(function(b,c){c=$(c);if(!javask.string.blank(c.attr("src"))&&javask.string.include(c.attr("src"),a))return d=c,!1});return d=javask.tag.jscript().attr({id:b,src:a}).appendTo(c)},_import:function(a,b,c){if(!javask.object.isNull(b)&&!javask.string.blank(b))switch(c=c||a.toUpperCase()+javask.math.rand().toString().replace(/\./,""),a){case "js":return javask.imports.loadJS(b,c);case "css":return javask.imports.loadCSS(b,c)}}});$.extend(javask.tag,{link:function(){return $("<link />")},css:function(){return javask.tag.link().attr({rel:"stylesheet",type:"text/css"})},script:function(){return $("<script />")},jscript:function(){return javask.tag.script().attr({type:"text/javascript"})},div:function(){return $("<div />")},span:function(){return $("<span />")},samp:function(){return $("<samp />")},p:function(){return $("<p />")},label:function(){return $("<label />")},a:function(){return $("<a />")},jsa:function(){return javask.tag.a().attr({href:"javascript:void(0);"})},ul:function(){return $("<ul />")},li:function(){return $("<li />")},input:function(a,b){return $('<input type="'+a+'" id="'+b+'" />')}});$.extend(javask,{_import:javask.imports._import});javask.imports._import("js",function(){var a,b="engine-"+javask.version+".js";$("script").each(function(c,d){d=$(d);javask.string.include(d.attr("src"),b)&&(a=d)});return!javask.object.isUndefined(a)?a.attr("src").replace(b,"config-"+javask.version+".js"):null}(),"Javask_Config");javask.object.isUndefined(window.console)&&(window.console={log:javask.N});